<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="paex360-logo.png">
  <title>PaEx360</title>
  <style>
    /* …aquí van tus estilos existentes… */
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <!-- Power BI client -->
  <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2/dist/powerbi.min.js"></script>
</head>
<body>
  <!-- 1) Contenedor de login -->
  <div id="auth-container">
    <!-- …tus inputs de email, password, botones… -->
  </div>

  <!-- 2) Contenedor del dashboard -->
  <div id="dashboard" style="display:none; flex-direction:column; height:100vh;">
    <header>
      <!-- logo, título, usuario, botón Cerrar sesión -->
    </header>
    <!-- aquí saldrá el dashboard -->
    <div id="reportContainer" style="width:100%; height:100%; display:none;"></div>
  </div>

  <script>
    // Inicializar Firebase
    const firebaseConfig = { /* tu config */ };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Función para mostrar el dashboard
    function showDashboard() {
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('dashboard').style.display = 'flex';
    }

    // Función para cargar Power BI
    async function loadPowerBI() {
      const container = document.getElementById('reportContainer');
      const resp = await fetch(
        'https://lucky-palmier-ad2422.netlify.app/.netlify/functions/getPowerBI',
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            workspaceId: '7230301b-540b-4f1a-b94d-c3ff22d4564d',
            reportId:   '4c205074-37ca-452d-b2cf-134e57e7cb96'
          })
        }
      );
      if (!resp.ok) {
        container.innerHTML =
          '<p style="color:red;text-align:center;">No se pudo cargar el dashboard.</p>';
        return;
      }
      const { embedToken, embedUrl, reportId } = await resp.json();
      container.style.display = 'block';
      const models = window['powerbi-client'].models;
      powerbi.embed(container, {
        type: 'report',
        id: reportId,
        embedUrl,
        accessToken: embedToken,
        tokenType: models.TokenType.Embed,
        permissions: models.Permissions.Read,
        viewMode: models.ViewMode.View
      });
    }

    // Función de login
    function login() {
      const email = /* recoger email */;
      const password = /* recoger password */;
      auth.signInWithEmailAndPassword(email, password)
        .then(userCred => {
          document.getElementById('user-email').textContent = email;
          showDashboard();
          loadPowerBI();  // ¡aquí lanzas el embed!
        })
        .catch(err => {
          // mostrar error al usuario
        });
    }

    // Función de logout
    function logout() {
      auth.signOut().then(() => {
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('auth-container').style.display = 'block';
      });
    }
  </script>
</body>
</html>
